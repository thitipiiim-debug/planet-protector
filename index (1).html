OCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Protector รักษ์โลกยกห้อง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 800px;
        }
        .video-thumbnail {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .video-thumbnail:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .video-thumbnail.selected {
            border: 4px solid #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Modal for messages -->
    <div id="modal" class="modal">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <h2 id="modal-title" class="text-2xl font-bold mb-4"></h2>
            <p id="modal-message" class="text-lg text-gray-700 mb-6"></p>
            <button id="modal-close" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                ตกลง
            </button>
        </div>
    </div>

    <div id="app" class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-2xl text-center">
        <h1 id="app-title" class="text-4xl font-extrabold text-gray-800 mb-6">โหวตกิจกรรม</h1>
        <h2 id="app-title" class="text-4xl font-extrabold text-gray-800 mb-6">Protect Planet</h2>
        <h2 id="app-title" class="text-4xl font-extrabold text-gray-800 mb-6">รักษ์โลกยกห้อง</h2>

        <!-- Login Section (visible by default) -->
        <div id="login-section" class="space-y-4">
            <h2 class="text-2xl font-semibold text-gray-700">เข้าสู่ระบบเพื่อโหวต</h2>
            <div class="flex flex-col items-center">
                <input type="text" id="studentIdInput" placeholder="กรอกเลขประจำตัว" class="w-full max-w-xs p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="loginBtn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300">
                    ยืนยัน
                </button>
            </div>
            <p id="userInfo" class="text-lg font-medium text-gray-600 mt-4"></p>
        </div>

        <!-- Voting Section (hidden by default) -->
        <div id="voting-section" class="hidden mt-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-6">กรุณาเลือกวิดีโอที่คุณชื่นชอบ</h2>
            <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                <!-- Video thumbnails will be dynamically added here -->
            </div>
            <button id="submitBtn" class="mt-8 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 hidden">
                ยืนยันการโหวต
            </button>
        </div>

        <!-- Admin Section (hidden by default) -->
        <div id="admin-section" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">สำหรับผู้ดูแลระบบ</h2>
            <button id="downloadBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300">
                ดาวน์โหลดผลโหวต (Excel)
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- Firebase Initialization and Authentication ---
       const firebaseConfig = {
  apiKey: "AIzaSyD7VClx8JxDaz7IfjmIxozyD3Bz9aYAXxA",
  authDomain: "votingapp-56662.firebaseapp.com",
  projectId: "votingapp-56662",
  storageBucket: "votingapp-56662.firebasestorage.app",
  messagingSenderId: "539997461642",
  appId: "1:539997461642:web:87cc6ace05d96feb3c2173",
  measurementId: "G-1GC5D4ZBPX"
};

        // Admin mode for demonstration
        const adminMode = true; // Set to true to enable the admin download button

        async function authenticateUser() {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                currentUserId = auth.currentUser.uid;
                console.log("Authentication successful. User ID:", currentUserId);
            } catch (error) {
                console.error("Authentication failed:", error);
                showMessageModal("เกิดข้อผิดพลาด", "ไม่สามารถเชื่อมต่อกับระบบได้ กรุณาลองใหม่อีกครั้ง");
            }
        }

        // CSV data from the user-uploaded file
        const csvData = `ลำดับ,เลขประจำตัว,ชื่อ,นามสกุล
1,45106,ภูมิชนก,ศรีสมุดคำ
2,45142,พีรวิชญ์,รอบเมือง
3,45168,โชติพิพัฒน์,ติยะไพรัช
4,45174,ปุณณวัชญ์,ศรีเรือง
5,45248,ปัณณทัต,เจริญโลหะกลกิจ
6,45252,ณัฏฐปพน,เขมเกษม
7,45282,จินตภัทร,นาแพร่
8,45290,ภูสิ,มณีวรรณ
9,45297,ธิติธร,ไชยเกิด
10,45381,ภูรธีร์เชศ,คชพรม
11,45389,ปุญญวิชญ์,ธารธีรวัฒน์
12,45407,ณัฐปคัลภ์,บุญทรัพย์อุดม
13,45412,นนทวัชร์,บุญศิริธรรม
14,45421,พุฒิพงศ์,ศรีโคตร
15,45423,ธีรภัทร,มะณีทอง
16,45446,ศุภกฤต,ขอดแก้ว
17,45471,พวิท,บัวปาย
18,45574,กันติทัต,ประดับมุข
19,45618,ธนน,อุตรคุณานนท์
20,46146,ชยกร,ภัททิยธรรม
21,46163,ณปภัช,ดวงศิริ
22,46175,นิตคุณณ์,พงศ์ธีรธัญธนา
23,49057,ทิชิค,ซาลิซส์
24,49094,กมลภู,ฐิตบุญนิมิต
25,45109,พรรณภัค,หน่อบุญยวง
26,45202,ภัทร์ธีมา,คุณพัฒน์วัฒนา
27,45211,ชมพูเนกข์,มณีมาโรจน์
28,45234,ไอริสา,ลาพา
29,45300,ริสา,พญามงคล
30,45313,อัศศิรินทร์,สุนทรเนตร
31,45319,เกตุชญา,ธารากรสันติ
32,45328,รวิสรา,พัฒนากรเกษม
33,45394,ปรางวรัญญา,เป็งแสนหนู
34,45434,ภวิกา,เมธประสพสันต์
35,45589,พิชญาพรรณ,บุญยะเสนา
36,45593,นลินี,อัตประชา
37,46164,นันท์นภัส,โด่งดัง
38,46166,พิมลดา,เครือใจ
39,46172,สุณัฐฉรีย์,จั่นเจริญ
40,49068,อชิรญา,มาตรวชิระ
41,49077,ปรรณพัชร์,บูรพาแสงสูรย์
42,49080,ชัญญา,โสมส่องแสง
43,50036,ริณณพัชญ์,สมใจ
44,45108,ก้องภพ,มหานิล
45,45133,อันวา,เซลามัน
46,45135,บารเมษฐ์,มโนรัตน์
47,45136,อัทธนีย์,อินมา
48,45147,พอ,วนะเกียรติกุล
49,45155,เสฏฐวุฒิณ์,เตียวกุล
50,45268,ดลพัทธ,สุคนธชาติ
51,45269,ธีรภัทร,ศรีอุบล
52,45281,วรัณณิพล,การดี
53,45283,พลวัฒน์,กองมูล
54,45293,ชัยกฤต,ทัพผดุง
55,45373,ธาริต,กล้าทำ
56,45376,รัชพล,โตฉาย
57,45378,ชฎายุ,หล้าแดง
58,45379,ภาคิน,ดวงแก้วน้อย
59,45391,ชวนนท์,กิตติชญากรณ์
60,45403,ธีรภัทร,นกแก้ว
61,45414,ชนกันต์,พรหมไชย
62,45420,ชวนากร,ศิริวัฒนาภานนท์
63,45620,ธณกฤต,ขาคำ
64,47238,ณัฐวรรธน์,พรหมวิจิตร
65,47239,จิรายุ,วิทูรากร
66,49064,ธีรภัทร,เพชราวุฒิโชติ
67,49070,ศุภกฤต,บุญยืน
68,49087,ภพธรรม,ทองมาก
69,45238,เพียงขวัญ,ทันดร
70,45333,กฤชภร,ใจทาหลี
71,45392,จิรัญญา,สิงห์ประพันธ์
72,45428,ก่อขวัญ,รัตนา
73,45453,สุณัฏฐา,ศรีคำ
74,45457,อัญชิษฐา,อุตสม
75,45474,พีชญาภา,พจน์พรพิทักษ์
76,45478,ณฐมน,พวงเงินมาก
77,45597,มินต์ญาภัทร,ทิพยเกษมศักดิ์
78,45602,จิรัชญา,เพ็งพันลำ
79,45626,ภูริชญา,อุดดง
80,45640,ธนิชฎาภรณ์,อินทะพล
81,46149,ปุณณ์ทิชานันท์,สุ่มมาตย์
82,46664,เชกิวา,บุญเป็ง
83,47242,พิมพ์ณภัช,สีดาเลิศทวีชัย
84,49076,กวินศ์ตรา,มะยอง
85,49097,ปวิชญา,แสนมา
86,45105,ทีปกร,ปุริโสตะโย
87,45117,วิชโย,ยุวศิลป์
88,45140,ยชญ์วรรธน์,แก้วประภา
89,45151,กฤษฎ์ณัชภัฏ,สุวรรณพงษ์กูล
90,45161,ธนาพงศ์,ปันผสม
91,45171,ณัฐภัค,จันทสิงห์
92,45276,พัสกร,เทียนทอง
93,45287,พุฒิเศรษฐ์,อินทะวงศ์
94,45335,ภูมิพิพัชญ์,พึ่งโพธิ์สภ
95,45375,ธรรมาธิป,ศรีสันต์
96,45377,ชนนน,เดชธรรมรงค์
97,45382,อริยอนันต์,อารีเอื้อ
98,45409,อาทินันท์,สุรวัฒนาวรรณ
99,45411,พีรวิชญ์,ตระกูลมีสอน
100,45439,พร้อมพิพัฒ,จันทะพิงค์
101,45486,เตชินท์,ยศสุข
102,45579,วิสุ,จันทิมา
103,45619,ฤทธิ์ธาม่วงพรม
104,45636,ณัฐฐศรัณฐ์,อนันชัย
105,46132,ธรรมรัตน์,ศรีพวก
106,46141,ลีแอม,ลี
107,46161,กฤตภาธร,สุตะวงค์
108,46171,ภัคพล,ภัทรวณิชาพงศ์
109,47547,เอวิน สมิตินันทน์,ลี
110,49073,ภควัต,สายละออ
111,49085,กฤษณพงศ์,มงพลเมือง
112,45187,อริสรา,สุระจิตร์
113,45195,ณัฎฐ์ณิชชา,ปัญญาดา
114,45199,ณชนก,วทานิยโรจน์
115,45204,กวิสรา,นิธิชลสุข
116,45213,นันท์นภัส,สุตีคา
117,45219,ธัญลักษณ์,ชัยวรรณารัตน์
118,45222,พิมพ์วลัญช์,สิงห์คร
119,45315,สาธิตา,ต้นวรรณา
120,45370,ณปภัช,เมืองลือ
121,45386,อันนา,จันทร์ต่วน
122,45475,จิดาภา,ชัยดำรงเลิศ
123,45479,อารดา,ริสุข
124,45494,พัชมณ,เพชรบุรี
125,45591,พรหมภัสสร,สุวรรณมงคล
126,45605,จารุรินทร์,ภิบาลแทน
127,45607,ธัญญ์พิชชา,เรืองวุฒิสาร
128,46157,ภิญญาพัชญ์,รินแก้ว
129,45102,ศุภภ์ณัฐ,จิตมั่นชัยธรรม
130,45104,ปริญญ์,เมฆะ
131,45112,พชร,พิงสุวรรณ
132,45113,ธีร์,กุลกนกพัฒนา
133,45122,สุทธิพจน์,พิพัฒนสุขมงคล
134,45123,ปวิช,คุณวรวินิจ
135,45125,ธนธรณ์,แสงศรี
136,45138,อรรฐวิชฒ์,อรุโณทยานันท์
137,45165,ธนภัทร,เจิดจำรัส
138,45178,รัฐธีร์,เทรล
139,45250,อชิตะ,ธรรมาธิติกุล
140,45299,รัถพล,เทพอาจ
141,45303,ก้องกิตติ,ใคร้ยงค์
142,45371,ไพศาล,เทพมาลัย
143,45372,บุญบัว,สมัญ
144,45383,กิตติศักดิ์,หวังพรไพบูลย์
145,46135,ชวกร,เมธาวิทยากรณ์
146,46148,พระพร,อินทะพันธุ์
147,46169,ภรัณพัชญ์,สักกะโต
148,46433,พุทธคุณ,ทรัพย์ปรุง
149,47281,ภัทรชนน,เรืองศรี
150,45184,กุลณวรา,เพียรเสถียรกุล
151,45191,อัยย์ญดา,ไวทยการ
152,45192,พริมพริมา,พันธุ์อุโมงค์
153,45227,ลลิลไลลา,สุขจริง
154,45230,ธีรดา,จุลศรีไกวัล
155,45308,ปานชนก,ไชยวงศ์
156,45310,อนัญญา,คูตระกูล
157,45321,อัณณ์วรา,หกพันนา
158,45324,รภัสธวัล,เขียวงาม
159,45331,เพียงหทัย,บัวอ่อน
160,45334,กนกวรา,เชียงบุญ
161,45426,ศรัลน์ภัทร์,จารุจิตร
162,45448,ชลิตา,อภิชัย
163,45488,วศิกานต์,ดวงแก้ว
164,45588,เกล้ากะรัต,ตั้งหมั่นกิจ
165,45592,ลลดา,จินตกานนท์
166,45594,ณิชาภัทร,จำปาคำ
167,45595,มาลีย์ญา,แก้วสนิท
168,45628,กชพร,เนตรรัศมี
169,46160,กาณฑ์วีรยา,สิริพิพัฒน์
170,47303,กันตพัฒน์,เรืองเจริญ
171,47329,วิคตอเรีย,แฟกโบฮัน
172,48166,เอวาริน,เทพสุคนธ์
173,45099,ธีธัธ,แจวจันทึก
174,45107,พชรนนท์,ศรีศิริ
175,45110,ไอฬวิล,งานคำอ้าย
176,45160,ณภูรี,คำมงคล
177,45247,ณัฏฐวัฒน์,บุรวิชเกษตรกร
178,45260,กันตธีร์,ตันสกุล
179,45277,ปัฑค์ปัณญธร,หาญณรงค์
180,45289,ชยภัค,นิติการุญ
181,45309,วุฒิภัทร,นันทการณ์
182,45388,พอเพียง,เมืองมาหล้า
183,45406,พลินทร์,รัตน์วุฒิกุล
184,45415,วาเล็นทิโน,พาคิน	รอนส์
185,45572,ปัณณทัต,สิงห์เส
186,45575,ธนกร,เสาวพนธ์
187,45598,จิรัฏฐ์,เรือนโรจน์รุ่ง
188,45621,กษิดิ์ดิตถ์,คงธนจารุอนันต์
189,45642,อัครินทร์,ทรมีฤทธิ์
190,46137,อัครฤทธิ์,บำรุงสุข
191,46159,ฉัตรชนก,นิตยวัน
192,46176,ณฐนนท์,ประทุมสังข์
193,47284,กวินภพ,สาธุเม
194,48215,ธีธัช,กาญจนวงศ์
195,45189,นันนพัทธ,ศาลากิจ
196,45190,ปรายรุ้ง,ขอบใจกลาง
197,45194,อัญญา,อาวรณ์
198,45196,ณัฐวลัญช์,พรปัณณวิชญ์
199,45200,ชนิดาภา,หวังเจริญพร
200,45208,มานาพร,ชัยบุญศรี
201,45232,สาริสา,บุญเลิศ
202,45237,พิชญดา,กิติเรืองแสง
203,45240,กัญญ์ณพัชร,ชุติพงษ์วิเวท
204,45345,ธัญลักษณ์,เศรษฐเสถียร
205,45416,จิณห์ณิชา,พรรัตนประเสริฐ
206,45449,ปัณณธร,ไชยราช
207,45463,พิชญ์ธิชา,พรมจันทร์
208,45590,ศนิตา,บุญเรือง
209,45596,ปัณณภรณ์,โชติพงศ์
210,45609,พจณิชา,นาคะผิว
211,45610,นพนิตา,จันทร์มา
212,45622,ณิชากานต์,โพธิ์ตาด
213,45635,ภิรมณ,ใจกล้า
214,46130,ปวริศา,วิชัยขัทคะ
215,46136,พิมพ์ฉัตร,สรรค์ศิริกุล
216,46138,ณัฏฐ์ชญา,อุ่นเมือง
217,45127,อัยย์,สุยะวา
218,45143,กวินท์,ศรีอำพร
219,45249,ปัณณทัต,ใจธรรม
220,45251,ณัฏฐกฤษฏิ์,ราชจันทร์
221,45253,ณัฐกฤต,ลุ่นเซียะ
222,45257,กันตพัฒน์,จิระนันทราพร
223,45261,ภฤทธิ์,พงศ์หล่อพิศิษฏ์
224,45262,ธนภัทร,ไชยสถาน
225,45272,ธนภัทร,เผือกขาว
226,45302,ณวุฒ,ภักดีวงษ์
227,45362,พอล เจคอบ,อุตซูร์รูม
228,45393,กฤตาณัฐ,ยอดใจ
229,45443,ชวกร,มหาไม้
230,45454,ชัชพล,ศรีสุวรรณ
231,45476,พชร,สุวรรณ์
232,45578,ธีระริทธิ์,ธีระวร
233,45638,วรธันย์,ศิรินภาพันธ์
234,46133,จารุวิทย์,โปร่งใจ
235,46152,พีรกร,หลักฐาน
236,46167,น่านนที,แก้วนำ
237,46463,ธาวิน,ปรีชากุลสัมพันธ์
238,47243,ณัฐกฤต,กองเมือง
239,47317,ปุณณวัฒน์,ทองเจริญ
240,45226,มริษฎา,ปิยะบงการ
241,45233,ณัฐพร,ธรรมชาติ
242,45239,ณัชริญา,ตรีวัฒนกูล
243,45316,ปรียาดา,จันทรศิริ
244,45326,รุจิรอังกูร,รุจิรตันติอังกูร
245,45349,ศิริภัทร,มายันต์
246,45351,กวินธิดา,มานพ
247,45358,กุลธีรา,ทองทับ
248,45360,ธีรนาฏ,ศุภศิริภิญโญ
249,45442,พรรณพัชนันท์,ผุยประกอบ
250,45456,วรชร,ภูมิสมบัติ
251,45460,ณัฐชยา,ปาลี
252,45462,อรนลิน,นิลบรรพต
253,45467,เชิญขวัญ,ชัยรังษี
254,45585,นันณภัชสรณ์,กอสุราษฎร์
255,45599,ภัควลัญชญ์,จินดาธรรม
256,45608,ศุภัคชญา,คำหวาน
257,46143,ธนภรณ์,พูลทะจักร์
258,47241,จิณศุจี,ชุ่มอุระ
259,47283,พาขวัญ,ชลามาตย์
260,48164,กีรติญา,สุยะเรือน
261,45119,พีรดนย์,ขุนทองพันธ์กิจ
262,45120,พงศกร,กองสิงห์
263,45130,จิรานุวัฒน์,ไชยา
264,45153,กัณต์ภวัต,สุขเส็ง
265,45159,รนนท์,ใจปลอด
266,45274,นันนนนน์,กันยวม
267,45275,ธนบดี,นิพัทธ์สิริสกุล
268,45279,สุวริศร์,ปกรณ์พุฒิพงศ์
269,45288,อภิวิชญ์,นันทขว้าง
270,45292,ภูวิศ,โสมขันเงิน
271,45365,ธีร์ธวัช,ถาปัน
272,45419,ทินภัทร,เจริญรัตน์
273,45441,ศักดิธัช,ณรงค์กูล
274,45451,ศิวพงษ์,สารอินทร์
275,45459,ณฐกฤต,จงทอง
276,45582,ธนภูมิ,บุตรป้อ
277,45603,ณัฐกิตติ์,สุขสวัสดิ์
278,45604,ญาณากร,กาญจนวรรณ
279,46145,ฉัตรปวีณ์,โกมลวุฒิสิทธิ์
280,46412,พชร,เขื่อนเพชร
281,46428,ณภัทร,อุประทอง
282,49078,ปิติคุณ,ชุติกุลสุข
283,45185,จิรปรียา,กำปั่นทอง
284,45193,ปุญณิศา,นาวิก
285,45203,ภฤดา,วงศ์ยัง
286,45218,ณหทัย,บุญยะประภา
287,45223,กะรัต,ปัญธิญา
288,45236,พัทธ์ธีรา,ตาถา
289,45244,ณฐกรภร,ทาวรรณะ
290,45338,เพียงฟ้า,ถ้ำแก้ว
291,45348,ชรัมพร,วิเชียรวรรธนะ
292,45352,พราวพัทธ์,บุญทวี
293,45355,สุวภัทร,ศรีอนันต์
294,45359,ปฐมา,ศรีวิชัย
295,45361,ทีราภรณ์,วงศ์ศรีใส
296,45396,วิมลมณี,ปินตาธรรม
297,45405,ชญานิศ,แสงมณี
298,45452,ลลดา,สีสุกไสย
299,45466,ธนภรณ์,ทองมุข
300,45472,ณปภัช,เอี่ยมอุดม
301,45483,ลลิตา,สารบูรณ์
302,45586,พิชญธิดา,ชัยวุฒิ
303,45625,ณิชากร,ทาอุโมงค์
304,47282,ภูวรินทร์,วิรุฬหมาลย์
305,45115,กรพิสิษฐ,ธุวดาราตระกูล
306,45116,กิตติภัทร์,ปิลันธนดิลก
307,45118,ฉัฐพิพัฒน์,วนพานิช
308,45124,พีรพัฒน์,ล่านพยา
309,45129,ธนกร,อินแหลง
310,45149,อาชวี,สุรเดชพัฒนา
311,45154,ปารย์,เดชารัตน์
312,45166,วุธิภัทร,ตันติโชติวัฒน์
313,45170,ณฐวัฒน์,ไพยารมณ์
314,45180,ธนินวัฒน์,รังสิยานนท์
315,45181,ธีร์ธวัช,เทพกิดาการ
316,45245,รพี,สมสมัย
317,45329,ธรรมณัฐ,พลอยอิสรา
318,45433,อารัญ,ณ ลำปาง
319,45487,ศิวกร,วีรวงศ์ตระกูล
320,45491,ณัฐณภัทร,กลัดสุข
321,45569,ชนะกฤษณ์,จันทร์ศุภเสน
322,45571,ชัยวัฒน์,บรรเลงสุวรรณ
323,45617,นวิน,อินทสาร
324,45633,ปุญญพัฒน์,เอื้อกุศลสมบูรณ์
325,46154,พุทธ,หวงธรรมชาติ
326,47551,ชัชรินทร์,บุญสากุล
327,45186,ณัฎฐณิชา,ธนาฤทธิ์
328,45206,เฌอตาณดา,ขาวสุทธิ์
329,45210,ชลกร,เหลืองอาภาพงศ์
330,45241,ณัฐปภาวริณ,คนเพียร
331,45320,เขมจิรา,ฟองจางวาง
332,45330,พรนัชชา,พัฒนศิลป์
333,45336,ภิญญาพัชญ์,พูลสวัสดิ์
334,45339,สุพรรณิกา,กุนสง
335,45340,โศจิรัตน์,จอมงาม
336,45350,อลิสา,ธรรมสร
337,45353,กัญญาณัฐ,พยัคฆา
338,45356,ไอริสา,คันธดอกไม้
339,45435,วรัชยา,จันทรบุญ
340,45437,ณัฐธิดา,พุทธปัญญา
341,45438,ภูณิดา,เกษตรไพศาล
342,45461,ณรัชภัค,อุตรสัก
343,45482,นภัสพลอย,ศรีเตรัตนสิน
344,45484,ซือรา,ชิน
345,45587,ภูริชญา,ทองปรอน
346,45641,ปทิดา,ปฐมวัฒนะกุล
347,46151,พรปภัทร,สลักพิศพักตร์
348,50040,ปพิชญา,กัมพลชัยพร
349,45137,กันตพงษ์,ไชยวงศ์
350,45145,อภิธาน,อินตา
351,45148,กันตพิชญ์,ศรีเรือง
352,45162,ปัณณวิชญ์,ศรีวิลัย
353,45167,ทัธนะ,ปัญโญกิจ
354,45169,ณัฐพัชร์,หน่อแก้ว
355,45172,กิจติพัชญ์,พิโลนพงศธร
356,45264,ภูวเดช,บูรณะพิมพ์
357,45265,อิ่มภัทร,พิพิธภัณฑ์
358,45266,ธนคุณ,แก้วบุญเรือง
359,45273,ชยานันต์,มณีรัตน์
360,45278,ณาศิส,คำ ณ พัฒน์
361,45291,แทนขวัญ,มูลถี
362,45298,ธีรธรรม,ลาภโชติกาญจน์
363,45337,นันทพัทธ์,จันทราภู
364,45346,ธีรทัศน์ เดชชนม์นิธิศ,แก้วทา
365,45368,ธนกฤต,ปันทนนท์
366,45401,จีระวุฒิ,เขมา
367,45480,อัครกร,หมื่นฝั้น
368,45489,อิฏฐ์พรชัย,จุลลาศรี
369,45573,ปิยวัฒน์,วิจารณ์
370,45577,วรพล,เตชะ
371,45612,เกียรติบดินทร์,แก้ววรรณะ
372,45614,ภคพงษ์,ทองเลิศ
373,45627,กานต์,ศุภรัตน์พิพัฒน์
374,45630,ฐาปกรณ์,วิศวโภคา
375,45637,คีวัฏฏะ,สมรทินกร
376,47235,จรรยวรรธน์,สาวงศ์ตุ้ย
377,50013,ปรมะ,มูลอ้าย
378,45216,นฎา,ตนานนท์
379,45228,ธัญญรัตน์,เขมะวงค์
380,45229,กฤษฎิ์พัสวี,ศรีวิชัย
381,45235,ซูเหยียน,เริน
382,45242,อิสรีย์,ฟูตระกูล
383,45317,อาชามาศ,ศรีวิชัยวงค์
384,45343,สุภามน,ไทยมี
385,45357,ณัจสิญาณ์,คูเจริญชัยมานที
386,45384,พีรดา,ผลปัญญา
387,45410,กัลยกร,พวงแก้ว
388,45436,ณัฐภัสสร,ปากองวัน
389,45465,ณัฏฐวิภา,บุญเพ็ญ
390,45469,ธัญชนก,อินแจ้
391,45613,ศิริขวัญ,ดวงฤทธิ์
392,46153,เฌนิศา,ทวีคุณ
393,48208,ชัญญณัท,จันทร์ทา
394,45111,ศุภกร,ใจเพชร
395,45126,ศรัณย์กร,สันคำ
396,45131,อัฑฒ์,กนกแสนไพศาล
397,45134,ธนกฤต,ภัคมัยสิริ
398,45144,ภูริณัฐ,ขันติจรัสภูวดล
399,45157,ประกาณฑ์,สุประดิษฐ
400,45173,ปภาวิชญ์,ตันตรานนท์
401,45255,ธนภัทร,พรหมมา
402,45258,ธีรดลย์,ปกป้องไพร
403,45259,จิร,พวงมาลัย
404,45263,ภานพ,สิงหเสนี
405,45267,ณัฐดนัย,หน่อเรือง
406,45284,จิตติพัฒน์,บุญจ๋อม
407,45305,อนพัช,ศรีสมโภชน์
408,45312,พาวิน,ศรีกาญจนพัฒน์
409,45374,จีรภัทร,ชิดนายี
410,45395,พัฒน์อธิศ,สมุทรวชิรวงษ์
411,45417,รัชพล,ดาราพงษ์
412,45473,ภาณุพงศ์,ไชยขัน
413,45493,ธีรพัทร,จันทร์แก้ว
414,45570,ปภัสร์พงษ์,บุญชื่น
415,45576,กวินทร์,ยาณะสาร
416,45583,พิรัชชัย,เชื้อนาค
417,45600,ปฐมพงษ์,ขันธสีมา
418,45606,เอกพัชร์,สิงหพงษ์
419,45615,กลวัชร,บุญเลิศ
420,45632,กฤตภาส,กันใหม่
421,46140,ภัทรณัฏฐ์,วงค์เสือ
422,49098,กฤตพชร,พนาลิกุล
423,45198,ภีรดา,สมบัตินันท์
424,45212,ปุญพิชชา,ประพฤติ
425,45215,ชนันภรณ์,มาลัยวรรณ
426,45220,อัณณ์ญาดา,สวพันธ์พงศ์
427,45221,กชกร,บุญขันธ์
428,45225,ณิชาภา,ชินโชติโสภณ
429,45306,ธฑารีย์,พสุวีปรีชาชัย
430,45318,ลภัสลิสา,เสนจันทร์ฒิไชย
431,45418,พิชญาภัค,เหลืองสุวรรณ์
432,45424,กมลชนก,เปงพันทิศ
433,45440,พีรดา,ทนันชัย
434,45611,วิชิตา,มณีวงค์
435,46144,จิรัชญา,สุยะใหญ่
436,46156,ณัฎฐิกา,อาระยะ
437,49091,สุภนิดา,ปัญโญใหญ่
438,50022,ชนิดาภา,เนตรลือชา
439,45121,พัทธนันท์,คำแห่
440,45128,กีรติกุล,สำอางค์กูล
441,45141,ศรัณวัชญ์,อินทร
442,45152,ทิทยพล,เงาเมฆ
443,45177,ภวินท์,ราชอุปนันท์
444,45285,ณฐภัทร,พงษ์ใจมา
445,45294,ภีรภัทร,ศรีพวก
446,45295,ภัทรพล,จินราษฎร์
447,45390,รัชชานนท์,ครองภา
448,45397,ณัฐวัฒน์,คำม่วง
449,45398,ชนชนม์,จรัสนิวัฒน์
450,45399,วโรดม,กันธิยะ
451,45400,กิตติพัชญ์,นันตาโจง
452,45402,ชวิน,ชัยมาทอง
453,45413,รักษ์ชัย,ศิรินิรันดร์กุล
454,45422,วรปรัชญ์,ข้าวแท่น
455,45431,สถิตพันธุ์,ใจซื่อ
456,45455,ณฤพัชร,เงินผ่อง
457,45492,อดิศักดิ์,นนทชัยโชติรัตน์
458,45580,ธามชัย,วสุวานิช
459,45623,นนทกร,ทักษอุดม
460,45634,ธรณ์ธันย์,นันท์ศุภวัฒน์
461,45643,ธนกร,คำภีระ
462,46147,พชร,เพ็ชรแสนงาม
463,46158,อนัตตามัน,พลเมืองศรี
464,46170,ณดลย์,หาญมุสิกวัฒน์กูร
465,46417,เธียรธาวิน,ปันธิดา
466,50004,ภูรินทร์,ศิริวรรณ์
467,45197,มุทิตา,เอมหฤทัย
468,45207,ลักษณ์นารา,สาธุมนัสพันธุ์
469,45209,พิชญา,ปัญญา
470,45311,ภรภัทร,โพธิ์นาคเงิน
471,45314,ธัญชนก,ปัญโญใหญ่
472,45325,ภัทรวรินทร์,ปันชุน
473,45347,นันท์นภัส,สุนันต๊ะ
474,45367,ฐิติยา,กิตติศักดิ์ธาดากุล
475,45427,ศรัณต์พัทธ์,เมฆอรุณ
476,45447,วชิราภรณ์,รื่นรมย์
477,45450,กฤติญา,นันตาโจง
478,45464,นิภารัตน์,แก้วนนท์
479,45470,ฤทัยชนก,พุทธขันธ์
480,45629,ปิยธิดา,สุวรรณ
481,46150,ชลมาตุ,ตุมมาราช
482,49075,ชนกชม,หลวงต่างใจ
483,50006,นลินญา,เงินหมื่น
484,45139,กฤตพัส,ไคร้งาม
485,45146,พิทยุตม์,ศิริ
486,45158,ณัฐวรรธน์,สุทธาชัยธรรม
487,45163,ภีรภัทร,ประพันธ์วงค์
488,45164,พงศ์ณภัทร,ผลชีวิน
489,45179,กิตติพิชญ์,แก้วทอง
490,45246,คุณภัทร,ปันเต
491,45254,กัญจน์,จันทร์ขอนแก่น
492,45271,เปรมภรศิษฐ์,ตานะเศรษฐ
493,45286,พชร,นาแสวง
494,45296,ณภัทร,พงเลา
495,45301,จอมร์ทรัพย์,จันทร์ขจรชัย
496,45307,พิงค์พล,หาญวชิระ
497,45332,ฟารีส,อดุลตระกูล
498,45364,ณัชพล,นุ้ยวรรณ์
499,45366,พีรพัฒน์,นะซอ
500,45387,พชร,วังมณี
501,45425,กรวิชญ์,กุณะ
502,45485,ศุภวิชญ์,มาซา
503,45581,นันทพัทธ์,วัฒนาปิยรมย์
504,45584,บารมีอนันต์,หงอกชัย
505,45601,ณฐวัฒน์,ใบเหลือง
506,45616,ฐกฤตธรณ์,เปรมภูติ
507,45624,ธนัยนันท์,วิกัน
508,45631,กฤษฎิ์ฉันทัช,อรุณนาวีเสถียร
509,45639,ณัฐกาญจน์,แสนสนิท
510,46134,ไรวินท์,ไชยา
511,48224,นิพัชร์ นวรัตน์,ณ อยุธยา
512,45182,จิณัฐตา,เติมสงวนวงศ์
513,45188,ไข่มุก,นาควิโรจน์
514,45205,พิณกวี,นครังกุล
515,45217,ณัฐพัชญ์,วงค์ชุมภู
516,45323,กานต์อภิสร,ชวสินธุ์
517,45327,กัลยรัตน์,โปธิคำ
518,45342,ณัฐณิชา,ชัยทา
519,45344,ชาลิสา,ปารมี
520,45354,กัญญาภัค,พยัคฆา
521,45363,ณัฐสินี,เอกมาก
522,45404,สิริอัญญา,โกฎยา
523,45430,ธมณฑ์ภัทร,อ่างเงิน
524,45445,กชนิภา,สร้อยเจริญกุล
525,45481,นภัตร์ศิริ,นิ่มมงคลศิลป์
526,46173,จิราภัทร,ชัยนันท์
527,49082,ณัฐวลัญญ์,ชัยเนตร
528,611218,คุณครูสุจิตรา,หาญภักดีสกุล
529,661213,คุณครูปรัชญา,ทำเสามูล
530,641203,คุณครูชลธร,เฉยฉิน
531,571214,คุณครูธนวัฒน์,โสภี
532,581206,คุณครูจิราพร,ประมูลจักโก
533,591206,คุณครูชนะกฤษฏ์,สุกใส
534,621203,คุณครูจินต์จุฑา,ปุกมณี
535,571210,คุณครูจุฬัญญ์ญา,ธรรมปัญญา
536,681210,คุณครูกชกร,ยาปัน
537,671215,คุณครูภัทรนันท์,ทินวล
538,651211,คุณครูณิชาพร,สิทธิไชย
539,561207,คุณครูสุชาดา,คำตื้อ
540,631207,คุณครูฐิติชญาณ์,บุญสูง
541,581231,คุณครูขวัญวรา,เครือสาร
542,681209,คุณครูสิรายุ,ยาวยืน
543,611214,คุณครูชฎาทิพย์,สุขุมานันท์
544,511215,คุณครูอรพรรณ,สมตุ้ย
545,371202,คุณครูธนัยนันท์,ฝันดีกรเกียรติ
546,671210,คุณครูสุดที่รัก,เต็มสวัสดิ์
547,371203,คุณครูกันยารัตน์,เศรษฐกร
548,621202,คุณครูอนุสรณ์,ยะอนันต์
549,541204,คุณครูกรรณรัตน์,สุระเดช
550,531203,คุณครูอนันต์,วงศ์ศรีใส
551,631208,คุณครูธีรภัทร์,สามัคคี
552,123456,Test,Test01
553,121212,T,est02`;

        const videoLinks = [
            { id: 1, link: "https://placehold.co/300x200/2563eb/ffffff?text=501", title: "ผลงาน ห้อง5/1", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 2, link: "https://placehold.co/300x200/2563eb/ffffff?text=502", title: "ผลงาน ห้อง5/2", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 3, link: "https://placehold.co/300x200/2563eb/ffffff?text=503", title: "ผลงาน ห้อง5/3", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 4, link: "https://placehold.co/300x200/2563eb/ffffff?text=504", title: "ผลงาน ห้อง5/4", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 5, link: "https://placehold.co/300x200/2563eb/ffffff?text=505", title: "ผลงาน ห้อง5/5", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 6, link: "https://placehold.co/300x200/2563eb/ffffff?text=506", title: "ผลงาน ห้อง5/6", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 7, link: "https://placehold.co/300x200/2563eb/ffffff?text=507", title: "ผลงาน ห้อง5/7", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 8, link: "https://placehold.co/300x200/2563eb/ffffff?text=508", title: "ผลงาน ห้อง5/8", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 9, link: "https://placehold.co/300x200/2563eb/ffffff?text=509", title: "ผลงาน ห้อง5/9", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 10, link: "https://placehold.co/300x200/2563eb/ffffff?text=510", title: "ผลงาน ห้อง5/10", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 11, link: "https://placehold.co/300x200/2563eb/ffffff?text=511", title: "ผลงาน ห้อง5/11", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
            { id: 12, link: "https://placehold.co/300x200/2563eb/ffffff?text=512", title: "ผลงาน ห้อง5/12", description: "หัวข้อ Planet Protect รักษ์โลกยกห้อง" },
        ];

        let studentData = {};
        let selectedVideo = null;

        // --- DOM Elements ---
        const loginSection = document.getElementById('login-section');
        const votingSection = document.getElementById('voting-section');
        const adminSection = document.getElementById('admin-section');
        const studentIdInput = document.getElementById('studentIdInput');
        const loginBtn = document.getElementById('loginBtn');
        const userInfoEl = document.getElementById('userInfo');
        const videoGrid = document.getElementById('video-grid');
        const submitBtn = document.getElementById('submitBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close');

        // --- Helper Functions ---
        function showMessageModal(title, message, onClose = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.style.display = 'flex';
            if (onClose) {
                modalCloseBtn.onclick = () => {
                    modal.style.display = 'none';
                    onClose();
                };
            } else {
                modalCloseBtn.onclick = () => {
                    modal.style.display = 'none';
                };
            }
        }

        function parseCsv(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = {};
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === 4) {
                    const studentId = values[1].trim();
                    data[studentId] = {
                        firstName: values[2].trim(),
                        lastName: values[3].trim(),
                        hasVoted: false, // Default status
                    };
                }
            }
            return data;
        }

        function renderVideoThumbnails() {
            videoGrid.innerHTML = '';
            videoLinks.forEach((video) => {
                const videoDiv = document.createElement('div');
                videoDiv.className = 'video-thumbnail bg-gray-200 rounded-xl overflow-hidden shadow-md p-2 transition duration-300 flex flex-col items-center text-center';
                videoDiv.dataset.videoId = video.id;
                videoDiv.innerHTML = `
                    <img src="${video.link}" alt="${video.title}" class="rounded-lg w-full mb-2">
                    <h3 class="font-bold text-lg text-gray-800">${video.title}</h3>
                    <p class="mt-1 text-sm text-gray-600">${video.description}</p>
                `;
                videoDiv.addEventListener('click', () => {
                    // Remove selected class from all thumbnails
                    document.querySelectorAll('.video-thumbnail').forEach(el => el.classList.remove('selected'));
                    // Add selected class to the clicked thumbnail
                    videoDiv.classList.add('selected');
                    selectedVideo = videoDiv.dataset.videoId;
                    submitBtn.classList.remove('hidden');
                });
                videoGrid.appendChild(videoDiv);
            });
        }

        async function checkUser(studentId) {
            const usersRef = doc(db, `artifacts/${appId}/public/data/users`, studentId);
            const userDoc = await getDoc(usersRef);
            return userDoc.exists() ? userDoc.data() : null;
        }

        // --- Event Listeners ---
        loginBtn.addEventListener('click', async () => {
            const studentId = studentIdInput.value.trim();
            if (!studentId) {
                showMessageModal("ข้อผิดพลาด", "กรุณากรอกรหัสประจำตัว");
                return;
            }

            const userData = studentData[studentId];
            if (!userData) {
                showMessageModal("เข้าสู่ระบบไม่สำเร็จ", "ไม่พบรหัสประจำตัวนี้ในระบบ");
                return;
            }

            const userInDB = await checkUser(studentId);
            if (userInDB && userInDB.hasVoted) {
                showMessageModal("แจ้งเตือน", "รหัสประจำตัวนี้ได้ทำการโหวตเรียบร้อยแล้ว");
                return;
            }

            userInfoEl.textContent = `ยินดีต้อนรับ, ${userData.firstName} ${userData.lastName}`;
            loginSection.classList.add('hidden');
            votingSection.classList.remove('hidden');
            renderVideoThumbnails();
        });

        submitBtn.addEventListener('click', async () => {
            if (!selectedVideo) {
                showMessageModal("ข้อผิดพลาด", "กรุณาเลือกวิดีโอก่อนยืนยันการโหวต");
                return;
            }

            const studentId = studentIdInput.value.trim();
            const userData = studentData[studentId];

            // Save vote to Firestore
            const voteData = {
                studentId: studentId,
                name: `${userData.firstName} ${userData.lastName}`,
                videoVote: selectedVideo,
                timestamp: new Date().toISOString(),
                userId: currentUserId,
            };

            const votesCollectionRef = collection(db, `artifacts/${appId}/public/data/votes`);
            await addDoc(votesCollectionRef, voteData);

            // Update user status to prevent duplicate votes
            const usersRef = doc(db, `artifacts/${appId}/public/data/users`, studentId);
            await setDoc(usersRef, { ...userData, hasVoted: true });

            showMessageModal("สำเร็จ!", "บันทึกการโหวตของคุณเรียบร้อยแล้ว ขอบคุณที่ร่วมกิจกรรม", () => {
                window.location.reload();
            });
        });

        downloadBtn.addEventListener('click', async () => {
            try {
                const votesRef = collection(db, `artifacts/${appId}/public/data/votes`);
                const querySnapshot = await getDocs(votesRef);
                const votes = [];
                const voteCounts = {};

                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    votes.push(data);
                    const videoId = data.videoVote;
                    voteCounts[videoId] = (voteCounts[videoId] || 0) + 1;
                });

                // Prepare data for Excel
                const summaryData = [['วิดีโอ', 'จำนวนโหวต']];
                for (let i = 1; i <= videoLinks.length; i++) {
                    summaryData.push([`วิดีโอที่ ${i}`, voteCounts[i] || 0]);
                }
                summaryData.push([]);
                summaryData.push(['รายละเอียดการโหวตทั้งหมด']);
                summaryData.push(['เลขประจำตัว', 'ชื่อ-นามสกุล', 'วิดีโอที่โหวต', 'เวลาที่โหวต']);
                votes.forEach(vote => {
                    summaryData.push([vote.studentId, vote.name, `วิดีโอที่ ${vote.videoVote}`, new Date(vote.timestamp).toLocaleString()]);
                });

                // Simple CSV creation for download
                const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + summaryData.map(e => e.join(",")).join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "ผลโหวต_กิจกรรม.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
                console.error("Error downloading vote data:", error);
                showMessageModal("ข้อผิดพลาด", "ไม่สามารถดาวน์โหลดข้อมูลได้ กรุณาลองใหม่อีกครั้ง");
            }
        });
        
        // Initial setup
        window.onload = async () => {
            await authenticateUser();
            studentData = parseCsv(csvData);
            // Hide the voting section and show the login section on initial load
            votingSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            
            // To prevent issues, render the thumbnails only after the user logs in
        };

    </script>

</body>
</html>
